{% extends "advisor/base.html" %}
{% block title %}{{ animal|capfirst }} Diagnosis - Animal Advisor{% endblock %}

{% block content %}
<div class="container">
    <h1 class="mb-4">{{ animal|capfirst }} Diagnosis</h1>

    <form method="post" id="diagnosisForm">
        {% csrf_token %}
        
        {% if animal == 'hen' %}
        <div class="card shadow mb-4">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">Select Hen Symptoms</h5>
            </div>
            <div class="card-body">
                <div class="symptom-grid">
                    {% for symptom in hen_symptoms %}
                    <div class="symptom-item">
                        <input type="checkbox" name="symptoms" value="{{ symptom }}" id="hen-{{ forloop.counter }}" class="symptom-checkbox">
                        <label for="hen-{{ forloop.counter }}" class="symptom-label">{{ symptom }}</label>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        {% elif animal == 'goat' %}
        <div class="card shadow mb-4">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">Select Goat Symptoms</h5>
            </div>
            <div class="card-body">
                <div class="symptom-grid">
                    {% for symptom in goat_symptoms %}
                    <div class="symptom-item">
                        <input type="checkbox" name="symptoms" value="{{ symptom }}" id="goat-{{ forloop.counter }}" class="symptom-checkbox">
                        <label for="goat-{{ forloop.counter }}" class="symptom-label">{{ symptom }}</label>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        {% elif animal == 'cow' %}
        <div class="card shadow mb-4">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">Select Cow Symptoms</h5>
            </div>
            <div class="card-body">
                <div class="symptom-grid">
                    {% for symptom in cow_symptoms %}
                    <div class="symptom-item">
                        <input type="checkbox" name="symptoms" value="{{ symptom }}" id="cow-{{ forloop.counter }}" class="symptom-checkbox">
                        <label for="cow-{{ forloop.counter }}" class="symptom-label">{{ symptom }}</label>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        {% elif animal == 'sheep' %}
        <div class="card shadow mb-4">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">Select Sheep Symptoms</h5>
            </div>
            <div class="card-body">
                <div class="symptom-grid">
                    {% for symptom in sheep_symptoms %}
                    <div class="symptom-item">
                        <input type="checkbox" name="symptoms" value="{{ symptom }}" id="sheep-{{ forloop.counter }}" class="symptom-checkbox">
                        <label for="sheep-{{ forloop.counter }}" class="symptom-label">{{ symptom }}</label>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% else %}
            <p>Unknown animal type.</p>
        {% endif %}

        <div class="selected-symptoms">
            <h3>Selected Symptoms:</h3>
            <div id="selectedSymptomsDisplay">No symptoms selected yet</div>
        </div>

        <div class="action-btns">
            <button type="submit" class="btn btn-primary">Diagnose</button>
            <button type="button" class="btn btn-outline" id="clearBtn">Clear Selection</button>
            <a href="{% url 'home' %}" class="btn btn-outline">Back to Home</a>
        </div>
    </form>

    {% if diagnosis %}
        <div class="alert alert-info mt-4">
            <h4>Diagnosis Result:</h4>
            <p>{{ diagnosis }}</p>
        </div>
    {% endif %}
</div>

<style>
    :root {
        --primary: #28a745;
        --primary-light: #5cb85c;
        --secondary: #e8f5e9;
        --accent: #4caf50;
        --text: #2e2e2e;
        --light: #f8f9fa;
        --card-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: var(--light);
        color: var(--text);
    }
    
    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
    }
    
    .card {
        border-radius: 8px;
        overflow: hidden;
        box-shadow: var(--card-shadow);
        margin-bottom: 2rem;
    }
    
    .card-header {
        background-color: var(--primary);
        color: white;
        padding: 1rem 1.5rem;
    }
    
    .card-header h5 {
        margin: 0;
        font-size: 1.25rem;
    }
    
    .card-body {
        padding: 1.5rem;
        background-color: white;
    }
    
    .symptom-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 1rem;
    }
    
    .symptom-item {
        position: relative;
    }
    
    .symptom-checkbox {
        position: absolute;
        opacity: 0;
    }
    
    .symptom-label {
        display: block;
        background-color: var(--secondary);
        border: 1px solid #c8e6c9;
        border-radius: 8px;
        padding: 0.8rem 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
        font-size: 0.9rem;
    }
    
    .symptom-label:hover {
        background-color: #c8e6c9;
    }
    
    .symptom-checkbox:checked + .symptom-label {
        background-color: var(--primary-light);
        color: white;
        border-color: var(--primary);
        box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);
    }
    
    .selected-symptoms {
        background-color: var(--secondary);
        padding: 1.5rem;
        border-radius: 8px;
        margin: 2rem 0;
    }
    
    .selected-symptoms h3 {
        margin-top: 0;
        color: var(--primary);
    }
    
    .action-btns {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-top: 2rem;
    }
    
    .btn {
        padding: 0.8rem 1.8rem;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s ease;
    }
    
    .btn-primary {
        background-color: var(--primary);
        color: white;
    }
    
    .btn-primary:hover {
        background-color: var(--accent);
    }
    
    .btn-outline {
        background-color: transparent;
        border: 2px solid var(--primary);
        color: var(--primary);
    }
    
    .btn-outline:hover {
        background-color: var(--secondary);
    }
    
    .alert-info {
        background-color: #d1ecf1;
        border-color: #bee5eb;
        color: #0c5460;
        padding: 1rem;
        border-radius: 8px;
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('diagnosisForm');
    const checkboxes = document.querySelectorAll('.symptom-checkbox');
    const selectedDisplay = document.getElementById('selectedSymptomsDisplay');
    const clearBtn = document.getElementById('clearBtn');
    
    // Update selected symptoms display
    function updateSelectedDisplay() {
        const selected = Array.from(checkboxes)
            .filter(checkbox => checkbox.checked)
            .map(checkbox => checkbox.value);
        
        if (selected.length === 0) {
            selectedDisplay.textContent = 'No symptoms selected yet';
        } else {
            selectedDisplay.innerHTML = selected
                .map(s => `<span class="symptom-tag">${s}</span>`)
                .join(', ');
        }
    }
    
    // Handle checkbox changes
    checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', updateSelectedDisplay);
    });
    
    // Clear selection
    clearBtn.addEventListener('click', function() {
        checkboxes.forEach(checkbox => {
            checkbox.checked = false;
            const label = checkbox.nextElementSibling;
            label.classList.remove('selected');
        });
        updateSelectedDisplay();
    });
    
    // Form validation
    form.addEventListener('submit', function(e) {
        const selected = Array.from(checkboxes).some(checkbox => checkbox.checked);
        if (!selected) {
            e.preventDefault();
            alert('Please select at least one symptom');
        }
    });
});
</script>
{% endblock %}